{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "00f603ec_fb016cbb",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2022-10-24T20:43:34Z",
      "side": 1,
      "message": "it\u0027s unclear to me whether you\u0027re actually fixing a bug with the adb binaries _we_ distribute, or just trying to build with Visual Studio or whatever. we won\u0027t be taking changes for the latter, and we\u0027ll want a specific repro case for the failure (and code that doesn\u0027t break the Linux/macOS builds!) for the former.",
      "revId": "2f3719236dd8588af3971cd7902ddb5106631d1c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c89ce7be_ed95f84d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1972022
      },
      "writtenOn": "2022-10-25T04:15:43Z",
      "side": 1,
      "message": "I have been building adb in Linux and Windows platform. This fix is required to compile adb for Windows platform and does not depend on compiler toolchain or IDE. Without this change, adb is not even possible to compile for Windows. The documentation[1] for shutdown API in Windows mentions the proper flags.\n\n[1]: https://learn.microsoft.com/en-us/windows/win32/api/winsock/nf-winsock-shutdown",
      "parentUuid": "00f603ec_fb016cbb",
      "revId": "2f3719236dd8588af3971cd7902ddb5106631d1c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3b499016_a9ea748e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1083168
      },
      "writtenOn": "2022-10-25T04:55:02Z",
      "side": 1,
      "message": "adb for windows should not be compiled on Windows. It is to be cross-compiled on Linux via Soong. \n\n```\n$ source build/envsetup.sh\n$ lunch sdk-eng\n$ m -j32 adb\n$ find out -name \"adb.exe\"\nout/soong/.intermediates/packages/modules/adb/adb/windows_x86/adb.exe\nout/soong/.intermediates/packages/modules/adb/adb/windows_x86/unversioned/adb.exe\n```\nPlease explain how you are attempting to build and what are the error messages.",
      "parentUuid": "c89ce7be_ed95f84d",
      "revId": "2f3719236dd8588af3971cd7902ddb5106631d1c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c0add41a_e64370cc",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1972022
      },
      "writtenOn": "2022-10-25T05:14:46Z",
      "side": 1,
      "message": "I am using this project https://github.com/nmeum/android-tools/ to compile adb. The fix does not depend on build system or compiler. The SHUT_WR and SHUT_RDWR flags are for unix-like system. Those are only changed here. Even if the adb is cross compiled in Linux for Windows platform that toolchain will use Windows header winsock2.h instead of sys/socket.h. I have added the error message in commit message. Here is the second one\n\n```\nadb/sysdeps.h:109:57: error: \u0027SHUT_RDWR\u0027 was not declared in this scope\n  109 | extern int adb_shutdown(borrowed_fd fd, int direction \u003d SHUT_RDWR);\n      |                                                         ^~~~~~~~~\nadb/sockets.cpp:290:28: error: \u0027SHUT_WR\u0027 was not declared in this scope\n  290 |     adb_shutdown(fd.get(), SHUT_WR);\n      |                            ^~~~~~~\n```",
      "parentUuid": "3b499016_a9ea748e",
      "revId": "2f3719236dd8588af3971cd7902ddb5106631d1c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "aad03068_3c91100d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1972022
      },
      "writtenOn": "2022-10-25T06:41:14Z",
      "side": 1,
      "message": "OK, now I understand the reason why soong did not get the error messages. The Android.bp file defines `_POSIX_SOURCE` macro. mingw-w64 added those unix-like flags for shutdown(2) in unistd.h as workaround, here https://github.com/mingw-w64/mingw-w64/commit/31a1d26f7ad061c658c096656b429fe977f77484. But Windows platform itself does not define/require `_POSIX_SOURCE` macro. So, there are two ways now.\n\n1. Use actual flags in shutdown() for native Windows platform and remove `_POSIX_SOURCE` workaround.\n2. Use the mingw-w64 workaround. In my humble opinion, this will not be the correct way to write the code.",
      "parentUuid": "c0add41a_e64370cc",
      "revId": "2f3719236dd8588af3971cd7902ddb5106631d1c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d45aad62_1db0053e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2022-10-25T15:49:13Z",
      "side": 1,
      "message": "we only support mingw. adb is already complicated enough needing to support that in addition to linux and macOS. there\u0027s no reason we\u0027d take on the extra work of supporting another windows variant that we don\u0027t build/test/ship/support ourselves (but it\u0027s open source, so you\u0027re free to do those things yourself of course).",
      "parentUuid": "aad03068_3c91100d",
      "revId": "2f3719236dd8588af3971cd7902ddb5106631d1c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}